---
import App from "../../layouts/App.astro";
import BlogItem from "../../components/BlogItem.astro";
import Pagination from "../../components/Pagination.astro";
import postIndex from "../../data/postIndex";
import { POSTS_PER_PAGE, CMS_URL } from "../../consts";

const totalPosts = postIndex.results.length;
const totalPages = Math.ceil( totalPosts/POSTS_PER_PAGE );

export const getStaticPaths = async () => {
  const totalPosts = postIndex.results.length;
  const totalPages = Math.ceil( totalPosts/POSTS_PER_PAGE );

  return Array.from({ length: totalPages }, (_, i) => i + 1).map(( item ) => {
    return {
      params: {
        page: item,
      }
    }
  });
}

const { page } = Astro.params;
const res = await fetch(`${CMS_URL}/wp-json/wp/v2/posts?page=${page}&per_page=${POSTS_PER_PAGE}&_embed`);
const posts = await res.json();
---
<App>
  <div class="container mx-auto">
    { posts.map( (post) => (
      <BlogItem postData={post} />
    )) }
    <Pagination currentPage={page} baseUrl="/page" totalPages={totalPages}/>
  </div>
</App>
