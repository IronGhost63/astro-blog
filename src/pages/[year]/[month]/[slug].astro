---
import App from "../../../layouts/App.astro";
import { CMS_URL } from "../../../consts";
import postsIndex from "../../../data/postIndex";

export const getStaticPaths = async () => {
  return postsIndex.results.map((item) => {
    const routes = {
      params: {
        year: item.year,
        month: item.month,
        slug: item.slug,
      }
    }

    console.log(routes);

    return routes;
  });
};

const { slug } = Astro.params;

console.log( slug );

const fetchData = async () => {
  const res = await fetch(`${CMS_URL}/wp-json/wp/v2/posts/?slug=${slug}&_embed`);
  const post = await res.json();

  return post;
}

const postData = await fetchData();
---
<App>
  <div class="container mx-auto">
    { postData.map( (post) => (
      <div class="post-body max-w-[720px] px-4 mx-auto">
        <div class="post-header">
          <h1 class="post-title heading-1" set:html={post.title.rendered} />
          <div class="post-cover py-4 mb-4 lg:mb-8">
            <img src={post._embedded['wp:featuredmedia'][0].source_url} alt={post.title.rendered} class="post-cover-image">
          </div>
        </div>
        <div class="post-content" set:html={post.content.rendered} />
      </div>
    )) }
  </div>
</App>
